---
name: today
description: Daily operating system for knowledge workers. Prepares your day with meeting prep, action items, email triage, and focus areas. Run at the start of each workday or use --setup to configure.
argument-hint: [--setup]
disable-model-invocation: true
allowed-tools: Read, Write, Edit, Bash, Glob, Grep, AskUserQuestion
---

# /today - Daily Operating System

Populate `_today/` with everything needed for today's work.

## What This Skill Does

- Prepares you for all meetings with relevant context
- Surfaces action items due today and overdue
- Triages your email inbox (if configured)
- Generates suggested focus areas for downtime
- Archives yesterday's files automatically

## First Run / Setup

If no configuration exists, or if user passes `--setup`, run the setup wizard.

### Check for Configuration

```python
import os
from pathlib import Path

# Look for config in current working directory
config_path = Path("_today/config.yaml")
setup_mode = "$ARGUMENTS" == "--setup"

if not config_path.exists() or setup_mode:
    # Run setup wizard (Step 0)
    run_setup = True
else:
    run_setup = False
```

### Step 0: Setup Wizard

Use AskUserQuestion to gather configuration:

**Question 1: Internal email domains**
```
"What email domains are internal to your organization?"
Examples: @company.com, @corp.company.com
This helps classify meetings as internal vs external.
```

**Question 2: Customer/Account folder**
```
"Do you have a folder with customer or account context?"
Options:
- Yes, specify path (e.g., "Accounts/", "Customers/", "Clients/")
- No, skip customer context
```

**Question 3: Google API status**
```
"Is Google Calendar API configured?"
Options:
- Yes, I have google_api.py set up
- No, I'll enter meetings manually
```

**Question 4: Email integration**
```
"Do you want email triage? (Requires Gmail API)"
Options:
- Yes, include email scanning
- No, skip email
```

**Write configuration to `_today/config.yaml`:**

```yaml
# Daily Operating System Configuration
# Generated by /today --setup

internal_domains:
  - "@yourcompany.com"

customer_folder: "Accounts"  # or null if skipped

integrations:
  calendar:
    enabled: true
    provider: "google"  # google | manual
    script_path: "scripts/google_api.py"
  email:
    enabled: false
    provider: "google"

archive_days: 7
```

---

## Execution Steps (After Setup)

### Step 1: Archive Yesterday

Move yesterday's files to archive before creating today's.

```bash
# Get yesterday's date
YESTERDAY=$(date -v-1d +%Y-%m-%d 2>/dev/null || date -d "yesterday" +%Y-%m-%d)
TODAY=$(date +%Y-%m-%d)

# Create directories if needed
mkdir -p _today/archive
mkdir -p _today/tasks

# Archive yesterday's files (if they exist)
if [ -f "_today/00-overview.md" ]; then
    mkdir -p "_today/archive/$YESTERDAY"

    # Move daily files (not tasks/, archive/, or config)
    for f in _today/*.md; do
        [ -f "$f" ] && mv "$f" "_today/archive/$YESTERDAY/" 2>/dev/null
    done
fi
```

**Archive structure:**
```
_today/
├── 00-overview.md              # Today's dashboard
├── 01-0900-meeting-name.md     # Meeting prep files
├── ...
├── 80-actions-due.md           # Action items
├── 81-suggested-focus.md       # Focus areas
├── 83-email-summary.md         # Email triage (if enabled)
├── tasks/                      # PERSISTENT - never archived
│   └── master-task-list.md
├── config.yaml                 # Configuration
└── archive/                    # Previous days
    └── 2026-01-20/
```

### Step 2: Fetch Today's Calendar

**If Google Calendar configured:**

```bash
python3 scripts/google_api.py calendar list 1
```

Parse JSON output. For each event extract:
- `id`: Event ID
- `summary`: Meeting title
- `start`: Start time
- `end`: End time
- `attendees`: List of email addresses

**If manual mode:**

Use AskUserQuestion to ask user to list their meetings for today.

### Step 3: Classify Each Meeting

For each event, classify by checking attendee domains:

```python
def classify_meeting(event, config):
    """
    Classify meeting as: customer, internal, personal, or external
    """
    attendees = event.get('attendees', [])
    internal_domains = config.get('internal_domains', [])

    if not attendees:
        return 'personal'

    external_attendees = []
    for email in attendees:
        is_internal = any(domain in email for domain in internal_domains)
        if not is_internal:
            external_attendees.append(email)

    if not external_attendees:
        return 'internal'

    # Check if external attendees match customer folder
    customer_folder = config.get('customer_folder')
    if customer_folder:
        # Try to match domain to customer folder
        for email in external_attendees:
            domain = email.split('@')[-1]
            customer_match = find_customer_folder(domain, customer_folder)
            if customer_match:
                return ('customer', customer_match)

    return 'external'
```

### Step 4: Generate Meeting Files

Create files in chronological order with naming convention:
`[NN]-[HHMM]-[type]-[name].md`

**File numbering:**
- `00` = overview (always first)
- `01-79` = meetings in chronological order
- `80-89` = reference documents (actions, focus, email)

#### For CUSTOMER Meetings

If customer folder exists and matches, load context:

```markdown
# [Customer] Meeting Prep
**[Time] | [Meeting Title]**

## Attendees
- [Name] (email) - [Role if known]

## Recent Context
*(From: [customer-folder]/recent files)*

[Summary of recent meetings or notes if found]

## Open Action Items
*(From: [customer-folder]/action files or master task list)*

- [ ] [Action item related to this customer]

## Discussion Topics
1. Follow up on: [recent items]
2. Check in on: [ongoing work]

## Notes

```

#### For INTERNAL Meetings

Generate minimal placeholder:

```markdown
# [Meeting Title]
**[Time] | Internal**

## Attendees
- [List from calendar]

## Notes

```

#### For PERSONAL Meetings

Generate minimal placeholder:

```markdown
# [Meeting Title]
**[Time] | Personal**

## Notes

```

### Step 5: Scan Email (If Enabled)

If email integration is enabled:

```bash
python3 scripts/google_api.py gmail search "is:unread in:inbox" 30
```

**Classification:**

| Priority | Criteria | Action |
|----------|----------|--------|
| **HIGH** | From customer domain, action words in subject | Surface in overview |
| **MEDIUM** | Internal colleagues, meeting-related | Note count |
| **LOW** | Newsletters, automated notifications | Can be archived |

Create `83-email-summary.md`:

```markdown
# Email Summary - [Date]

## High Priority ([count])

| From | Subject | Preview |
|------|---------|---------|
| [sender] | [subject] | [snippet] |

## Summary
- **High priority**: [X] emails need attention
- **Medium**: [X] emails (internal, meetings)
- **Low**: [X] emails (newsletters, automated)

## Suggested Actions
- [ ] Reply to [sender] re: [subject]
- [ ] Review [topic] email thread
```

### Step 6: Aggregate Action Items

Scan for action items from:
1. `_today/tasks/master-task-list.md` (if exists)
2. Customer folder action files (if configured)

Look for patterns:
- `- [ ]` unchecked items
- Due dates: "Due:", date patterns
- Owner: "Owner:" patterns

Create `80-actions-due.md`:

```markdown
# Action Items - [Date]

## Overdue

- [ ] **[Action]** - Due: [Date] (X days overdue)
  - Source: [file path]

## Due Today

- [ ] **[Action]**
  - Source: [file path]

## Related to Today's Meetings

### [Meeting Name] ([Time])
- [ ] [Action relevant to this meeting]

## Due This Week

- [ ] **[Action]** - Due: [Date]
```

### Step 7: Generate Suggested Focus

Create `81-suggested-focus.md`:

```markdown
# Suggested Focus - [Date]

## Priority 1: Pre-Meeting Prep
- [ ] Review [Customer] prep before [time] call

## Priority 2: Overdue Items
- [ ] Address [action] (X days overdue)

## Priority 3: Follow-ups
- [ ] [Items from email or recent meetings]

## If Time Available
- [ ] [Lower priority items]
```

### Step 8: Generate Overview

Create `00-overview.md`:

```markdown
# Today: [Day, Month Date, Year]

## Schedule

| Time | Event | Type | Prep |
|------|-------|------|------|
| 9:00 AM | Daily Prep | Personal | - |
| 11:00 AM | Team Sync | Internal | - |
| 2:00 PM | **Customer Call** | **Customer** | See 03-1400-customer-acme.md |

## Customer Meetings Today

### [Customer] ([Time])
- **Prep**: See [filename]
- **Key topics**: [from prep file]

## Action Items - Quick View

### Overdue
- [ ] [Action] - Due: [Date]

### Due Today
- [ ] [Action]

## Email Summary
- **High priority**: [X] emails
- **Total unread**: [X] emails

See `83-email-summary.md` for details.

## Suggested Focus for Downtime

1. [Top priority]
2. [Second priority]
```

---

## Output Structure

After running `/today`:

```
_today/
├── 00-overview.md                  # Today's dashboard
├── 01-0900-personal-prep.md        # First meeting
├── 02-1100-internal-team-sync.md   # Second meeting
├── 03-1400-customer-acme.md        # Customer meeting (full prep)
├── 80-actions-due.md               # Action items
├── 81-suggested-focus.md           # Focus suggestions
├── 83-email-summary.md             # Email triage (if enabled)
├── tasks/                          # Persistent
│   └── master-task-list.md
├── config.yaml                     # Configuration
└── archive/                        # Previous days
```

---

## Error Handling

**If Google API unavailable:**
- Fall back to manual meeting entry
- Show warning in overview

**If customer folder not found:**
- Generate minimal prep without context
- Note: "Customer folder not found - limited context"

**If no meetings today:**
- Create overview noting "No meetings scheduled"
- Focus on action items and email

---

## Related Files

- `references/google-api-setup.md` - How to configure Google API
- `references/email-classification.md` - Email triage rules
- `references/meeting-types.md` - Meeting classification logic
- `templates/` - Output file templates
